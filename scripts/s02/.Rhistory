section_ini
eval.config(file = rwkf.ini, config = 'pathoqc', value = "bin_path")
eval.config(file = rwkf.ini, config = 'pathoqc', value = "bin_path2")
a <- 'slfasfa.fa'
b <- '*slfasfa.fa'
startsWith(a,'*')
startsWith(b,'*')
b[2:8]
gsub(b,'*','')
b
gsub(b,'\*','')
gsub(b,'\\*','')
?gsub
out_worksheet_fn <- run_method(rstep,
out_worksheet_fn,srange_str=srange_str)
out_worksheet_fn <- run_method(rstep,
out_worksheet_fn,
srange_str=srange_str)
out_worksheet_fn <- run_method(rstep,
out_worksheet_fn,srange_str=srange_str)
getwd()
setwd("~/projects/pathoscope/scripts")
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
c
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
prog_info
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
prog_info
prog_info$bin_path
is.null(prog_info$bin_path)
stopifnot(!is.null(prog_info$bin_path))
stopifnot(file.exists(prog_info$bin_path))
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
cmd_str <- sprintf("grep -P '^#' %s | cut -f2,3,4,5 | grep -w '^%d'",worksheet_file,step)
step
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
sdt
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
mdt
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
mdt_req
mdt
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
mdt
mdt_req
is.null(mdt_req)
length(mdt_req)
dim(mdt_req)
dim(mdt_req)[0]
sample_cols <- colnames(sdt)
mdt_sreq <- mdt[condition=='s.required',]
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
srange_str
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
sample_indices
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
worksheet_file
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
worksheet_file
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
prog_info
n
n
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
worksheet_file
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
prog_opt2
trimws(prog_opt2)
length(trimws(prog_opt2))
prog_opt2
trimws(prog_opt2)
library(stringr)
str_trim(prog_opt2)
length(str_trim(prog_opt2))
prog_opt2 <- 'NA'
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
prog_opt2
is.na(prog_opt2)
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
prog_opt2
runinst$method
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
runinst$rstep$method
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
sample
output_dir
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
prev_method
rstep$sdt[s,output_col]
rstep$sdt
output_col
rstep$method
rstep$mdt
rstep$mdt[item=='output_col',value]
output_col <- rstep$mdt[item=='output_col',value]
output_dir <- rstep$sdt[s,eval(output_col)]
output_dir
rstep$sdt[s,'output_dir']
rstep$sdt[s,get(output_col)]
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
output_dir <- rstep$sdt[s,get(output_col2)]
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
output_dir
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
outfpat <- runinst$rstep$mdt$output_file_suffix
outfpat
runinst$rstep$mdt
outfpat <- runinst$rstep$mdt[item=='output_file_suffix',value]
outfpat
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
inputs
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
inputs
output_dir
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
outputs
fpats0
outfpat
fpats <- strsplit(outfpat,';')[[1]]
fpats
fpats0 <- lapply(fpats,function(fpat){return(substr(fpat, 2, length(fpat)))})
fpats0
fpat <- fpats[[0]]
fpat <- fpats[[1]]
fpat
substr(fpat,2,length(fpat))
library(stringr)
substr(fpat,2,length(fpat))
substr("abcdef", 2, 4)
fpat
length(fpat)
strlen(fpat)
substr(fpat,2,nchar(fpat))
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
out_dt
source('~/projects/hwanglab/lib/R/lib_workflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
rstep$sdt
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
sdt
sdt[65,]
sdt <- sdt[!is.null(Sample),]
sdt
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
rstep$sdt
q()
rep(NA,3)
list(rep(NA,3))
list(unlist(rep(NA,3)))
c(c('a','b'),'d')
c(c('a'),'d')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
R3
out_dt
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
rstep$mdt
rstep$mdt
upd_worksheet_fn
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
rstep
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
message(sprintf('samples[%s]/total[%d] to be analyzed by [%s]',srange_str,dim(rstep$sdt)[1],rstep$method))
indir_col
indir_col
R
infname_cols
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
inputs <- list()
r
R
r=1
s = 1
inputs[[r]] <- file.path(rstep$sdt[s,get(indir_col)],
rstep$sdt[s,get(infname_cols[[r]])])
rstep$sdt
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
method
mdt
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
data.table(step=rstep$step,
item='started',
value=as.character(Sys.time()),
condition='optional')
rstep$step
View(rstep)
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
stepi
mdt[item=='step',value]
mdt
names(mdt)
mdt$step
mdt$step[1]
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
upd_worksheet_fn
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
stepi
mdt
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
mdt_by_step
method_dt
method_dt <- method_dt[!is.na(step),]
method_dt
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
S
rstep$sdt
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
sdt_upd
upd_worksheet_fn
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
out_dt
method_out
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
method_out
method_out
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
prog_opt1
prog_opt2
prog_opt2
output_dir
source('~/projects/hwanglab/lib/R/lib_workflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/hwanglab/lib/R/lib_workflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
outfpat <- 'salfjas.alfslf.as.txt'
strsplit(outfpat,';')[[1]]
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
prev_rstep
args
is.na(args)
is.null(args)
if (is.null(args)) {}
if (is.null(args)) {message('yes')}
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
debugSource('~/projects/pathoscope/scripts/rworkflow.r')
q()
setwd("~/projects/apa/activemotif_fastq/encode_analy_out/scripts/chipseq_integration_v1/output_01/spark_analy")
library(data.tabl)
library(openssl)
library(openxlsx)
pearson_xls <- '../reg_proximal_mnlp_mm_apa_ublocks_m1_s1_ccp_K10_cpearson_analy.xlsx'
dt <- as.data.table(read.xlsx(pearson_xls))
library(data.table)
pearson_xls <- '../reg_proximal_mnlp_mm_apa_ublocks_m1_s1_ccp_K10_cpearson_analy.xlsx'
dt <- as.data.table(read.xlsx(pearson_xls))
dt
dt <- setnames(dt,
c('ccls_2','ccls_3','ccls_4','ccls_5','ccls_6','ccls_7','ccls_8','ccls_9','ccls_10'),
c('pearson_s1_2','pearson_s1_3','pearson_s1_4','pearson_s1_5','pearson_s1_6','pearson_s1_7','pearson_s1_8','pearson_s1_9','pearson_s1_10'))
dt
spearman_xls <- '../reg_proximal_mnlp_mm_apa_ublocks_m1_s0_ccp_K10_cpearson_analy.xlsx'
spearman_xls <- '../reg_proximal_mnlp_mm_apa_ublocks_m1_s0_ccp_K10_cpearson_analy.xlsx'
dt2 <- as.data.table(read.xlsx(spearman_xls))
spearman_xls <- '../reg_proximal_mnlp_mm_apa_ublocks_m1_s0_ccp_K10_cspearman_analy.xlsx'
dt2 <- as.data.table(read.xlsx(spearman_xls))
dt2
dt2[match(dt$pos,dt2$pos),paste0('ccls_%d',2:10)]
dt2[match(dt$pos,dt2$pos),list(paste0('ccls_%d',2:10))]
dt2[,list(paste0('ccls_%d',2:10))]
dt2[,c(paste0('ccls_%d',2:10))]
dt2[,c(paste0('ccls_',2:10))]
dt2[match(dt$pos,dt2$pos),c(paste0('ccls_',2:10))]
cbind(dt,dt2[match(dt$pos,dt2$pos),c(paste0('ccls_',2:10))])
dt2 <- setnames(dt2,
c('ccls_2','ccls_3','ccls_4','ccls_5','ccls_6','ccls_7','ccls_8','ccls_9','ccls_10'),
c('spearman_s0_2','spearman_s0_3','spearman_s0_4','spearman_s0_5','spearman_s0_6','spearman_s0_7','spearman_s0_8','spearman_s0_9','spearman_s0_10'))
dt <- cbind(dt,dt2[match(dt$pos,dt2$pos),c(paste0('ccls_',2:10))])
dt <- cbind(dt,dt2[match(dt$pos,dt2$pos),c(paste0('spearman_s0_',2:10))])
dt
rm(dt2)
kmean_xls <- './apa_chipseq_mbd_cvgKMEANS_groupInfo.xlsx'
dt2 <- as.data.table(read.xlsx(kmean_xls))
dt2
dt2 <- setnames(dt2,'ID','pos')
dt2 <- setnames(dt2,
sprintf('(K=%d)',2:20),
sprintf('kmean_%d',2:20))
kmean_xls <- './apa_chipseq_mbd_cvgNMF_groupInfo.xlsx'
debugSource('~/projects/apa/activemotif_fastq/encode_analy_out/scripts/chipseq_integration_v1/output_01/spark_analy/gather_all_clustering_results.r')
dt2
dt
dt
debugSource('~/projects/apa/activemotif_fastq/encode_analy_out/scripts/chipseq_integration_v1/output_01/spark_analy/gather_all_clustering_results.r')
dt
dt[is.na(roi3),c('pearson_8','spearman_8','kmean_8','nmf_8')]
dt[!is.na(roi3),c('pearson_8','spearman_8','kmean_8','nmf_8')]
names(dt)
setwd("~/projects/apa/activemotif_fastq/encode_analy_out/scripts/chipseq_integration_v1")
setwd("~/projects/apa/activemotif_fastq/encode_analy_out/scripts/chipseq_integration_v1")
fwrite(dt,file='./output_01/a05_gather_all_clustering_results.tsv',sep='\t')
source(file.path(Sys.getenv('R_UTIL'),'lib_util.R'))
View(get_file_base)
debugSource('~/projects/apa/activemotif_fastq/encode_analy_out/scripts/chipseq_integration_v1/a06_cluster_analy.r')
dt
gr <- makeGRanges(dt)
gr
apa
apa_call
q()
q()
getwd()
debugSource('~/projects/apa/activemotif_fastq/encode_analy_out/scripts/chipseq_integration_v1/a06_cluster_analy.r')
debugSource('~/projects/apa/activemotif_fastq/encode_analy_out/scripts/chipseq_integration_v1/a06_cluster_analy.r')
ccls_by_gene
getwd()
debugSource('~/projects/apa/activemotif_fastq/encode_analy_out/scripts/chipseq_integration_v1/a05_gather_all_clustering_results.r')
dt2
q()
q()
library(RColorBrewer)
col <- sample(color, 10)
q()
source('~/projects/apa/activemotif_fastq/encode_analy_out/scripts/chipseq_integration_v1/a07_gen_heatmap.r')
debugSource('~/projects/apa/activemotif_fastq/encode_analy_out/scripts/chipseq_integration_v1/b07_gen_heatmap_filtw.r')
mbd_dt
dt
signal_dt <- fread(args$input_tsv)
signal_dt
source('~/projects/apa/activemotif_fastq/encode_analy_out/scripts/chipseq_integration_v1/b07_gen_heatmap_filtw.r')
source('~/projects/apa/activemotif_fastq/encode_analy_out/scripts/chipseq_integration_v1/b07_gen_heatmap_filtw.r')
setwd("~/projects/apa/paper_submission/polyAseq/scripts/s02")
source('~/projects/apa/paper_submission/polyAseq/scripts/s02/10_pas_stats_figure.r')
source('../../paddle-git/paddle.r')
View(countHexes)
debugSource('~/projects/apa/paper_submission/polyAseq/scripts/s02/10_pas_stats_figure.r')
f1
fl
gr
debugSource('~/projects/apa/paper_submission/polyAseq/scripts/s02/10_pas_stats_figure.r')
hctdko
pr
pr$pr
cnt
cntargs$expr
args$expr
args$expr
args$ctrl
debugSource('~/projects/apa/paper_submission/polyAseq/scripts/s02/10_pas_stats_figure.r')
fl
debugSource('~/projects/apa/paper_submission/polyAseq/scripts/s02/10_pas_stats_figure.r')
dim(tbl)
dim(tab)
tab
debugSource('~/projects/apa/paper_submission/polyAseq/scripts/s02/10_pas_stats_figure.r')
debugSource('~/projects/apa/paper_submission/polyAseq/scripts/s02/10_pas_stats_figure.r')
library(ggplot2)
tab.per
dev.off()
dev.off()
pdf(file=args$out_fpath,width=4,height=4)
#ggplot(tab,aes(x=run,y=Freq,fill=Var1)) + geom_bar(stat="identity") + handy::ggnice() + scale_fill_manual(values=cols)
ggplot(tab.per,aes(x=run,y=Freq,fill=motif)) + geom_bar(stat="identity") + handy::ggnice() + scale_fill_manual(values=cols) + labs(y="Fraction of Regions",x="")
dev.off()
if (dir.exists(tmp_dir)) {unlink(tmp_dir,recursive = T)}
debugSource('~/projects/apa/paper_submission/polyAseq/scripts/s03/08_pas_stats_figure.r')
pr$pr
pr
View(countHexes)
names(pr$counts)
names(pr$counts$raw)
pr$counts$raw
colnames(pr$counts$raw)
pmatch(tag,pr_count_cln)
tag <- 'HCT116'
pr_count_cln <- colnames(pr$counts$raw)
pmatch(tag,pr_count_cln)
tag
pr_count_cln
pmatch(tag,pr_count_cln)
tag
pr_count_cln
unlist(pr_count_cln)
tag
pmatch(tag,pr_count_cln)
tag
tag2 <- 'HCT116'
pmatch(tag2,pr_count_cln)
pmatch("H",pr_count_cln)
pmatch("DICER_1",pr_count_cln)
pmatch("med", c("mean", "median", "mode"))
pmatch("DICER_1",pr_count_cln)
pmatch("DICER",pr_count_cln)
pmatch("DICER",unlist(pr_count_cln))
pmatch("DICER",c("DICER_1","DICER_2","DKO_2"))
pmatch("DICE",c("DICER_1","DICER_2","DKO_2"))
pmatch("DICE", c("DICER_1","DICER_2","DKO_2"))
pmatch("DICER", c("DICER_1","DICER_2","DKO_2"))
startsWith("DICER", c("DICER_1","DICER_2","DKO_2"))
startsWith("DICER", c("DICER_1","DICER_2","DKO_2"))
startsWith(c("DICER_1","DICER_2","DKO_2"),"DICER")
pr_count_cln <- colnames(pr$counts$raw)
tag
my_col_idx <- which(startsWith(pr_count_cln,tag))
ret <- pr$counts$raw[,my_col_idx,with=F]
my_col_idx
pr$counts$raw
pr$counts$raw[,my_col_idx]
ret <- pr$counts$raw[,my_col_idx,with=T]
ret <- pr$counts$raw[,my_col_idx,with=F]
ret <- pr$counts$raw[,my_col_idx]
ret
library(data.table)
ret <- pr$counts$raw[,my_col_idx,with=F]
ret <- pr$counts$raw[,my_col_idx,with=T]
rowMeans(ret)
ret <- pr$counts$raw[,my_col_idx]
pr_dt <- ret[rowMeans(ret)>=10,]
pr_dt
pr$pr
pr$pr[(pr$pr$pr %in% pr_dt$pr),]
pr$pr$pr
pr$pr[(pr_dt$pr %in% pr$pr$pr),]
pr_dt
pr_of_interest <- rownames(pr_dt)
pr$pr[(pr_of_interest %in% pr$pr$pr),]
pr$pr[(pr$pr$pr %in% pr_of_interest),]
head(pr_of_interest)
pr_count_cln <- colnames(pr$counts$raw)
pr_clns <- pr_count_cln[startsWith(pr_count_cln,tag)]
pr_clns
pr_dt <- pr$counts$raw[,get(pr_cln)]
pr_cln <- pr_clns[[1]]
pr_cln
pr_dt <- pr$counts$raw[,get(pr_cln)]
pr_dt <- pr$counts$raw[,eval(pr_cln)]
pr_dt
pr_dt <- pr_dt[pr_dt>0]
pr_dt
pr_of_interest <- rownames(pr_dt)
hexlist[[pr_cln]] <- countHexes(pr$pr[(pr$pr$pr %in% pr_of_interest),])
pr$pr[(pr$pr$pr %in% pr_of_interest),]
pr_of_interest
pr_of_interest <- rownames(pr_dt)
pr_of_interest
pr_dt <- pr$counts$raw[,eval(pr_cln)]
pr_dt <- pr_dt[pr_dt>0]
pr_dt
names(pr_dt)
pr_of_interest <- names(pr_dt)
hexlist[[pr_cln]] <- countHexes(pr$pr[(pr$pr$pr %in% pr_of_interest),])
names(hexlist)
args <- data.table(prepropa='../../01_wkd/polyASeqs_rep2/03_CallApa/output/prepropa.rd',
ctrl='HCT116',
expr='DKO',
polyadb_fpath="../../data/polya_db2/PolyADB_2.bed",
out_dir="../../01_wkd/polyASeqs_rep2/03_CallApa/output")
source('../../paddle-git/paddle.r')
load(args$prepropa)
library(goldmine)
# Want to show HCT/DKO univ vs DB vs Null
hexlist <- list()
pr_count_cln <- colnames(pr$counts$raw)
for (tag in c(args$ctrl,args$expr)) {
pr_clns <- pr_count_cln[startsWith(pr_count_cln,tag)]
for (pr_cln in pr_clns) {
pr_dt <- pr$counts$raw[,eval(pr_cln)]
pr_dt <- pr_dt[pr_dt>0]
pr_of_interest <- names(pr_dt)
hexlist[[pr_cln]] <- countHexes(pr$pr[(pr$pr$pr %in% pr_of_interest),])
}
}
# PolyA DB 2
pad <- fread(args$polyadb_fpath)
pa <- with(pad,GRanges(V1,IRanges(V2,V3),strand=V6))
pa <- pa[seqnames(pa) %in% handy::chrs()]
pa <- unique(pa)
padp <- countHexes(gr=pa)
hexlist$pAdb2 <- padp
# Null
tmp_dir <- "/tmp/10_pas_stats_figure"
if (!dir.exists(tmp_dir)) {dir.create(tmp_dir)}
dgp <- drawGenomePool(query=hctdko,n=10,genome="hg19",cachedir=tmp_dir,sync=FALSE)
q()
